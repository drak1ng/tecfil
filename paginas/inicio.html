<!DOCTYPE html>
<!--
    Copyright (c) 2012-2014 Adobe Systems Incorporated. All rights reserved.
    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at
    http://www.apache.org/licenses/LICENSE-2.0
    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
     KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.
-->
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <link rel="stylesheet" type="text/css" href="../css/index.css" />
        <link rel="stylesheet" type="text/css" href="../css/jquery.mobile-1.4.5.min.css" />
        <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,700">
        <title>Tecfil</title>
		<script type="text/javascript" src="../js/jquery.min.js"></script>
		<script type="text/javascript" src="../js/jquery.mobile-1.4.5.min.js"></script>
		<script type="text/javascript" src="../js/cordova.js"></script>
	</head>
    <body>
	    <div data-role="page" style="background:#ffe01a; text-align:center;">
			<div style="width:300px; height:440px; position:fixed; top:50%; left:50%; margin:-220px 0px 0px -150px;">
			    <br>
			    <img src="../img/logo.png" alt="Tecfil" width="90%" style="margin:0px 0px 30px 0px;">
			    <br>
			  <input type="email" id="login_email" placeholder="E-mail">
			  <input type="password" id="login_senha" placeholder="Senha">
			  <div style="border:2px solid #003263; border-radius:10px; background:#003263; color:#FFF; padding:10px; margin-top:10px; text-shadow: none; text-transform:none;" id="bt_login_acessar">Acessar</div>
			  <div style="border:2px solid #003263; border-radius:10px; background:none; color:#003263; padding:10px; margin-top:40px; text-shadow: none; text-transform:none;" id="bt_login_esqueci_senha">Esqueci minha senha</div>
			  <div style="border:2px solid #003263; border-radius:10px; background:none; color:#003263; padding:10px; margin-top:10px; text-shadow: none; text-transform:none;" id="bt_login_criar_conta">Criar uma nova conta</div>
			</div>
			
			<script>
				
				$("#bt_login_acessar").click(function(){
					
					var email = $('#login_email').val();
					var senha = $('#login_senha').val();
					
					if(email==""){ alert("O campo E-mail deve ser preenchido"); return false; }
					if(senha==""){ alert("O campo Senha deve ser preenchido"); return false; }
					
					$.get("http://homologacao.gruposofape.com.br/tecfil/catalogo/app_api/login.php", { email:email, senha:senha }, function(data){
						if(data=="ERRO"){
							alert("O E-mail ou a Senha utilizados não são válidos");
						}else{
							window.localStorage.setItem('id_usuarios',data);
							$.mobile.changePage("catalogo_home.html", { transition: "fade", changeHash: false });
						}
					});
					
				});
				
				$("#bt_login_esqueci_senha").click(function(){
					//$.mobile.changePage("esqueci_minha_senha.html", { transition: "fade", changeHash: false });
					
					db.transaction(listarRegistros, errorCB3);
				});
				
				$("#bt_login_criar_conta").click(function(){
					$.mobile.changePage("cadastro.html", { transition: "fade", changeHash: false });
				});
				
				function listarRegistros(){
					alert('Teste');
				}
				
			</script>
			
			<script type="text/javascript" charset="utf-8">

				var db = "";
				
				function populateDB(tx) {
					
					tx.executeSql('DROP TABLE IF EXISTS db_automoveis');
					tx.executeSql('CREATE TABLE IF NOT EXISTS db_automoveis ( id TEXT NOT NULL, id_mont TEXT NOT NULL, modelo TEXT NOT NULL, descricao TEXT NOT NULL, motor TEXT NOT NULL, ano_de TEXT NOT NULL, ano_ate TEXT NOT NULL, combustivel TEXT NOT NULL, capacidade_carter TEXT NOT NULL, ar_cabine TEXT NOT NULL, local_loc TEXT NOT NULL, ar_1 TEXT NOT NULL, ar_2 TEXT NOT NULL, lubrificante_1 TEXT NOT NULL, lubrificante_2 TEXT NOT NULL, diesel_1 TEXT NOT NULL, diesel_2 TEXT NOT NULL, direcao TEXT NOT NULL, sedimentador TEXT NOT NULL, imagem TEXT NOT NULL)');

					
				}
				
				function queryDB(tx) {
				    tx.executeSql('SELECT * FROM db_automoveis', [], querySuccess, errorCB3);
				}
				
				function querySuccess(tx,result){
				    var players = "";
				    var len = result.rows.length;
				    for (var i=0; i<len; i++){
				        alert(result.rows.item(i).id + result.rows.item(i).id_mont);
				    }
				}
				
				
				function errorCB1(err) {
					alert("Error processing SQL1: "+err.message);
				}
				function errorCB2(err) {
					alert("Error processing SQL2: "+err.code);
				}
				function errorCB3(err) {
					alert("Error processing SQL3: "+err.code);
				}
				
				
				function successCB() {
					update_automoveis();
					//db.transaction(queryDB);
				}
				
				
				
				db = window.openDatabase("Database", "1.0", "Tecfil", 200000);
				db.transaction(populateDB, errorCB1, successCB);
				
				
				function update_automoveis(){
				
					itens_atualizados = 0;
				
					$.ajax({
						type: "GET",
						url: "http://homologacao.gruposofape.com.br/tecfil/catalogo/app_api/update.php?id=automoveis.xml",
						dataType: "xml",
						success: function(xml, tx){
							$(xml).find('automoveis').each(function(){
								var id = $(this).find('id').text();
								var id_mont = $(this).find('id_mont').text();
								var modelo = $(this).find('modelo').text();
								var descricao = $(this).find('descricao').text();
								var motor = $(this).find('motor').text();
								var ano_de = $(this).find('ano_de').text();
								var ano_ate = $(this).find('ano_ate').text();
								var combustivel = $(this).find('combustivel').text();
								var capacidade_carter = $(this).find('capacidade_carter').text();
								var ar_cabine = $(this).find('ar_cabine').text();
								var local_loc = $(this).find('local_loc').text();
								var ar_1 = $(this).find('ar_1').text();
								var ar_2 = $(this).find('ar_2').text();
								var lubrificante_1 = $(this).find('lubrificante_1').text();
								var lubrificante_2 = $(this).find('lubrificante_2').text();
								var diesel_1 = $(this).find('diesel_1').text();
								var diesel_2 = $(this).find('diesel_2').text();
								var direcao = $(this).find('direcao').text();
								var sedimentador = $(this).find('sedimentador').text();
								var imagem = $(this).find('imagem').text();
					
								itens_atualizados++;
								$('#login_email').val("Total Atualizado: "+itens_atualizados);
								
								var consulta_executar = function(tx,result){
									tx.executeSql('INSERT INTO db_automoveis (id, id_mont, modelo, descricao, motor, ano_de, ano_ate, combustivel, capacidade_carter, ar_cabine, local_loc, ar_1, ar_2, lubrificante_1, lubrificante_2, diesel_1, diesel_2, direcao, sedimentador, imagem) VALUES ("'+id+'","'+id_mont+'","'+modelo+'","'+descricao+'","'+motor+'","'+ano_de+'","'+ano_ate+'","'+combustivel+'","'+capacidade_carter+'","'+ar_cabine+'","'+local_loc+'","'+ar_1+'","'+ar_2+'","'+lubrificante_1+'","'+lubrificante_2+'","'+diesel_1+'","'+diesel_2+'","'+direcao+'","'+sedimentador+'","'+imagem+'")');
								}
							});
						}
					});
				}
				
			</script>
		
		</div>
    </body>
</html>